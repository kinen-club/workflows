# Kinen Onboard Workflow (Reusable)
# Called when user first pushes to their new space

name: Kinen Onboard

on:
  workflow_call:
    inputs:
      club_url:
        description: 'Kinen Club endpoint URL'
        required: false
        type: string
        default: 'https://kinen.club'

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome message
        run: |
          echo "ðŸŽ‰ Welcome to Kinen!"
          echo "Repository: ${{ github.repository }}"
          echo "Owner: ${{ github.repository_owner }}"

      - name: Create welcome issue (if not exists)
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            // Check if onboarding session already exists
            const existingIssues = await github.rest.issues.listForRepo({
              owner,
              repo,
              labels: 'onboarding',
              state: 'all'
            });

            if (existingIssues.data.length > 0) {
              console.log('Onboarding session already exists, skipping creation');
              return;
            }

            const body = [
              '# ðŸŽ¯ Let\'s Discover Your First Session!',
              '',
              'Welcome to Kinen! Before diving in, let\'s figure out what you\'d like to explore.',
              '',
              '**Reply to this issue** (or via email) and tell me:',
              '',
              '- What are you working on or thinking about lately?',
              '- What problems are you trying to solve?',
              '- What topics or skills do you want to explore?',
              '- Is there a project idea you\'ve been putting off?',
              '',
              'Don\'t worry about being preciseâ€”just share what\'s on your mind. I\'ll help you turn it into a focused session.',
              '',
              '---',
              '',
              '*This is your first Kinen session! I\'ll ask questions, help you clarify your thoughts, and suggest a concrete next step.*',
              '',
              'ðŸ“§ **Reply via email:** `' + repo + '+1@' + owner + '.kinen.space`',
              '',
              'ðŸ’¡ **Or comment directly on this issue**'
            ].join('\n');

            await github.rest.issues.create({
              owner,
              repo,
              title: 'ðŸš€ Your First Session: What Should We Explore?',
              body: body,
              labels: ['kinen-session', 'onboarding']
            });

            console.log('Welcome issue created!');
