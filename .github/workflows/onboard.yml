# Kinen Onboard Workflow (Reusable)
# Called when user first pushes to their new space

name: Kinen Onboard

on:
  workflow_call:
    inputs:
      club_url:
        description: 'Kinen Club endpoint URL'
        required: false
        type: string
        default: 'https://kinen.club'

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome message
        run: |
          echo "ðŸŽ‰ Welcome to Kinen!"
          echo "Repository: ${{ github.repository }}"
          echo "Owner: ${{ github.repository_owner }}"
          
      - name: Create welcome issue
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const body = [
              '# Your Kinen Space is Ready!',
              '',
              'Your workspace has been set up successfully.',
              '',
              '## Quick Start',
              '',
              '1. **Install the GitHub App** (if not done): [Install Kinen](https://github.com/apps/kinen-club)',
              '2. **Set up your API key** in Repository Settings â†’ Secrets â†’ Actions:',
              '   - `OPENAI_API_KEY` or',
              '   - `GEMINI_API_KEY` or',
              '   - `ANTHROPIC_API_KEY`',
              '3. **Start a session** by sending an email to: `your-project@' + owner + '.kinen.space`',
              '',
              '## How It Works',
              '',
              '1. You send an email describing what you want to build',
              '2. AI creates an issue and asks clarifying questions',
              '3. You reply by email',
              '4. AI works on your code and updates the issue',
              '5. Repeat until done!',
              '',
              '## Resources',
              '',
              '- [Kinen Club](https://kinen.club) - Platform home',
              '- [Kinen Methodology](https://kinen.club/methodology.md) - How AI sessions work',
              '',
              'Happy building! ðŸš€'
            ].join('\n');

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ðŸ‘‹ Welcome to your Kinen Space!',
              body: body,
              labels: ['kinen-welcome']
            });
